(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[188],{2188:function(e,t,a){Promise.resolve().then(a.bind(a,291)),Promise.resolve().then(a.bind(a,8730)),Promise.resolve().then(a.bind(a,9441))},291:function(e,t,a){"use strict";a.d(t,{ThemeProvider:function(){return o}});var n=a(7437);a(2265);var r=a(5922);function o(e){let{children:t,...a}=e;return(0,n.jsx)(r.f,{...a,children:t})}},8730:function(e,t,a){"use strict";a.d(t,{AuthProvider:function(){return c},a:function(){return l}});var n=a(7437),r=a(2265),o=a(2141),i=a(1121);let s=(0,r.createContext)(void 0);function c(e){var t;let{children:a}=e,[c,l]=(0,r.useState)(null),[u,d]=(0,r.useState)(!0),m=(0,o.J)(),h=async e=>{try{var t;if(!(null===(t=e.user_metadata)||void 0===t?void 0:t.display_name)){let t=(0,i.f6)(e);await (0,i.yf)(e,t)}}catch(e){console.error("Failed to save user display name:",e)}},f=(0,r.useCallback)(async()=>{try{let{data:{user:e},error:t}=await m.auth.getUser();if(t){"Auth session missing!"!==t.message&&console.error("Error refreshing user:",t);return}l(e)}catch(e){e instanceof Error&&"Auth session missing!"!==e.message&&console.error("Failed to refresh user:",e)}},[m.auth]),v=(0,r.useCallback)(async(e,t)=>{try{(null==t?void 0:t.user)?(l(t.user),await h(t.user),setTimeout(async()=>{try{let{data:{user:e}}=await m.auth.getUser();e&&l(e)}catch(e){console.error("Error getting latest user:",e)}},500)):l(null)}catch(e){console.error("Error in auth state change:",e),l(null)}d(!1)},[m.auth]);(0,r.useEffect)(()=>{let e=!0,t=async()=>{try{let{data:{user:t},error:a}=await m.auth.getUser();if(a){"Auth session missing!"!==a.message&&console.error("Error getting user:",a),l(null),d(!1);return}if(e){if(t){l(t),await h(t);let{data:{user:a}}=await m.auth.getUser();a&&e&&l(a)}d(!1)}}catch(t){t instanceof Error&&"Auth session missing!"!==t.message&&console.error("Failed to initialize auth:",t),e&&(l(null),d(!1))}},{data:{subscription:a}}=m.auth.onAuthStateChange(v);return t(),()=>{e=!1,a.unsubscribe()}},[m.auth,v]);let y=async(e,t)=>{let{data:a,error:n}=await m.auth.signUp({email:e,password:t,options:{data:{role:"user"}}});return{data:a,error:n}},g=async(e,t)=>{let{data:a,error:n}=await m.auth.signInWithPassword({email:e,password:t});return{data:a,error:n}},w=async()=>{let{error:e}=await m.auth.signOut();if(e)throw e},p=async()=>{let{error:e}=await m.auth.signInWithOAuth({provider:"google",options:{redirectTo:"".concat(window.location.origin,"/auth/callback")}});if(e)throw e},b=async(e,t)=>{let{error:a}=await m.auth.signInWithPassword({email:e,password:t});if(a)throw a},_=async(e,t)=>{let{error:a}=await m.auth.signUp({email:e,password:t,options:{emailRedirectTo:"".concat(window.location.origin,"/auth/callback"),data:{role:"user"}}});if(a)throw a},C=async e=>{let{error:t}=await m.auth.resetPasswordForEmail(e,{redirectTo:"".concat(window.location.origin,"/auth/reset-password")});if(t)throw t},E=(null==c?void 0:null===(t=c.user_metadata)||void 0===t?void 0:t.role)==="admin";return(0,n.jsx)(s.Provider,{value:{user:c,loading:u,signUp:y,signIn:g,signOut:w,signInWithGoogle:p,signInWithEmail:b,signUpWithEmail:_,resetPassword:C,isAdmin:E,refreshUser:f},children:a})}function l(){let e=(0,r.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},2141:function(e,t,a){"use strict";a.d(t,{J:function(){return o}});var n=a(5452);let r=null,o=()=>{if(!r)try{r=(0,n.createClientComponentClient)()}catch(e){throw console.error("创建Supabase客户端失败:",e),e}return r}},1121:function(e,t,a){"use strict";a.d(t,{By:function(){return l},b3:function(){return r},f6:function(){return i},yf:function(){return o}});var n=a(2141);function r(e){var t,a,n;return e?(null===(t=e.user_metadata)||void 0===t?void 0:t.display_name)?e.user_metadata.display_name:(null===(a=e.user_metadata)||void 0===a?void 0:a.full_name)?e.user_metadata.full_name:(null===(n=e.user_metadata)||void 0===n?void 0:n.name)?e.user_metadata.name:e.email?s(e.email):"User":"Guest"}async function o(e,t){if(!e)return!1;try{let e=(0,n.J)(),{data:a,error:r}=await e.auth.updateUser({data:{display_name:t}});if(r)return console.error("Failed to update display name:",r),!1;return!0}catch(e){return console.error("Error updating display name:",e),!1}}function i(e){var t;return e?(null===(t=e.user_metadata)||void 0===t?void 0:t.display_name)?e.user_metadata.display_name:e.email?s(e.email):"User":""}function s(e){let t=e.split("@")[0];return[/\d/,/[._-]/,/^[a-z]+$/,/^[A-Z]+$/,/^[a-zA-Z0-9._-]+$/].some(e=>e.test(t))?function(e){let t=e.replace(/[._-]/g," ").replace(/\d+$/,"").trim();return t?c(t):c(e)}(t):c(t)}function c(e){return e?e.charAt(0).toUpperCase()+e.slice(1).toLowerCase():e}function l(e){var t,a;return e&&((null===(t=e.user_metadata)||void 0===t?void 0:t.avatar_url)||(null===(a=e.user_metadata)||void 0===a?void 0:a.picture))||null}},5922:function(e,t,a){"use strict";a.d(t,{F:function(){return l},f:function(){return u}});var n=a(2265),r=["light","dark"],o="(prefers-color-scheme: dark)",i="undefined"==typeof window,s=n.createContext(void 0),c={setTheme:e=>{},themes:[]},l=()=>{var e;return null!=(e=n.useContext(s))?e:c},u=e=>n.useContext(s)?e.children:n.createElement(m,{...e}),d=["light","dark"],m=e=>{let{forcedTheme:t,disableTransitionOnChange:a=!1,enableSystem:i=!0,enableColorScheme:c=!0,storageKey:l="theme",themes:u=d,defaultTheme:m=i?"system":"light",attribute:g="data-theme",value:w,children:p,nonce:b}=e,[_,C]=n.useState(()=>f(l,m)),[E,S]=n.useState(()=>f(l)),T=w?Object.values(w):u,k=n.useCallback(e=>{let t=e;if(!t)return;"system"===e&&i&&(t=y());let n=w?w[t]:t,o=a?v():null,s=document.documentElement;if("class"===g?(s.classList.remove(...T),n&&s.classList.add(n)):n?s.setAttribute(g,n):s.removeAttribute(g),c){let e=r.includes(m)?m:null,a=r.includes(t)?t:e;s.style.colorScheme=a}null==o||o()},[]),A=n.useCallback(e=>{let t="function"==typeof e?e(e):e;C(t);try{localStorage.setItem(l,t)}catch(e){}},[t]),x=n.useCallback(e=>{S(y(e)),"system"===_&&i&&!t&&k("system")},[_,t]);n.useEffect(()=>{let e=window.matchMedia(o);return e.addListener(x),x(e),()=>e.removeListener(x)},[x]),n.useEffect(()=>{let e=e=>{e.key===l&&A(e.newValue||m)};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[A]),n.useEffect(()=>{k(null!=t?t:_)},[t,_]);let P=n.useMemo(()=>({theme:_,setTheme:A,forcedTheme:t,resolvedTheme:"system"===_?E:_,themes:i?[...u,"system"]:u,systemTheme:i?E:void 0}),[_,A,t,E,i,u]);return n.createElement(s.Provider,{value:P},n.createElement(h,{forcedTheme:t,disableTransitionOnChange:a,enableSystem:i,enableColorScheme:c,storageKey:l,themes:u,defaultTheme:m,attribute:g,value:w,children:p,attrs:T,nonce:b}),p)},h=n.memo(e=>{let{forcedTheme:t,storageKey:a,attribute:i,enableSystem:s,enableColorScheme:c,defaultTheme:l,value:u,attrs:d,nonce:m}=e,h="system"===l,f="class"===i?"var d=document.documentElement,c=d.classList;".concat("c.remove(".concat(d.map(e=>"'".concat(e,"'")).join(","),")"),";"):"var d=document.documentElement,n='".concat(i,"',s='setAttribute';"),v=c?(r.includes(l)?l:null)?"if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'".concat(l,"'"):"if(e==='light'||e==='dark')d.style.colorScheme=e":"",y=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=!(arguments.length>2)||void 0===arguments[2]||arguments[2],n=u?u[e]:e,o=t?e+"|| ''":"'".concat(n,"'"),s="";return c&&a&&!t&&r.includes(e)&&(s+="d.style.colorScheme = '".concat(e,"';")),"class"===i?t||n?s+="c.add(".concat(o,")"):s+="null":n&&(s+="d[s](n,".concat(o,")")),s},g=t?"!function(){".concat(f).concat(y(t),"}()"):s?"!function(){try{".concat(f,"var e=localStorage.getItem('").concat(a,"');if('system'===e||(!e&&").concat(h,")){var t='").concat(o,"',m=window.matchMedia(t);if(m.media!==t||m.matches){").concat(y("dark"),"}else{").concat(y("light"),"}}else if(e){").concat(u?"var x=".concat(JSON.stringify(u),";"):"").concat(y(u?"x[e]":"e",!0),"}").concat(h?"":"else{"+y(l,!1,!1)+"}").concat(v,"}catch(e){}}()"):"!function(){try{".concat(f,"var e=localStorage.getItem('").concat(a,"');if(e){").concat(u?"var x=".concat(JSON.stringify(u),";"):"").concat(y(u?"x[e]":"e",!0),"}else{").concat(y(l,!1,!1),";}").concat(v,"}catch(t){}}();");return n.createElement("script",{nonce:m,dangerouslySetInnerHTML:{__html:g}})}),f=(e,t)=>{let a;if(!i){try{a=localStorage.getItem(e)||void 0}catch(e){}return a||t}},v=()=>{let e=document.createElement("style");return e.appendChild(document.createTextNode("*{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),document.head.appendChild(e),()=>{window.getComputedStyle(document.body),setTimeout(()=>{document.head.removeChild(e)},1)}},y=e=>(e||(e=window.matchMedia(o)),e.matches?"dark":"light")}}]);