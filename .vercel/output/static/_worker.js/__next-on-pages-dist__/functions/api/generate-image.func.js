var z=Object.defineProperty;var J=Object.getOwnPropertyDescriptor;var Q=Object.getOwnPropertyNames;var ee=Object.prototype.hasOwnProperty;var te=(u,k)=>()=>(u&&(k=u(u=0)),k);var W=(u,k,C,x)=>{if(k&&typeof k=="object"||typeof k=="function")for(let E of Q(k))!ee.call(u,E)&&E!==C&&z(u,E,{get:()=>k[E],enumerable:!(x=J(k,E))||x.enumerable});return u},q=(u,k,C)=>(W(u,k,"default"),C&&W(C,k,"default"));var ne=u=>W(z({},"__esModule",{value:!0}),u);var $={};import*as ft from"async_hooks";var Y=te(()=>{q($,ft)});import{__getNamedExports as _e}from"../../../__next-on-pages-dist__/webpack/5603.js";import{__getNamedExports as re}from"../../../__next-on-pages-dist__/webpack/26df63ef8f6dd468813d90c00f151653.js";import{__getNamedExports as oe}from"../../../__next-on-pages-dist__/webpack/1175.js";import{__getNamedExports as ae}from"../../../__next-on-pages-dist__/webpack/1d2470119d4f846d0a077893f2422c32.js";import{__getNamedExports as se}from"../../../__next-on-pages-dist__/webpack/73a23316e6943b71c3775abd2b4c802e.js";import{__getNamedExports as ce}from"../../../__next-on-pages-dist__/webpack/7f9c4cac928c3718390c1c777cb83bc3.js";import{__getNamedExports as ue}from"../../../__next-on-pages-dist__/manifest/537259e2ed205f5a7994cb4f05664668.js";var h=globalThis.__nextOnPagesRoutesIsolation.getProxyFor("/api/generate-image"),ie=_e(h,h,h),pe=ie.__chunk_5603,F=re(h,h,h),he=F.__chunk_6195,de=F.__chunk_2067,ke=F.__chunk_5558,le=F.__chunk_5303,ge=F.__chunk_5228,fe=oe(h,h,h),me=fe.__chunk_1175,V=ae(h,h,h),xe=V.__chunk_9985,Ee=V.__chunk_4155,d=se(h,h,h),be=d.__chunk_1730,ye=d.__chunk_3818,ve=d.__chunk_7037,Ne=d.__chunk_5577,Pe=d.__chunk_1863,Ae=d.__chunk_3039,Oe=d.__chunk_9573,Ie=d.__chunk_7701,we=d.__chunk_662,Re=d.__chunk_7444,je=d.__chunk_4591,Se=d.__chunk_932,Te=d.__chunk_5234,Ce=d.__chunk_2561,Me=d.__chunk_2988,Le=d.__chunk_2039,$e=d.__chunk_5028,Fe=d.__chunk_9548,Ue=d.__chunk_6914,De=d.__chunk_7960,Ke=d.__chunk_5996,Xe=d.__chunk_4337,i=ce(h,h,h),Be=i.__chunk_5405,Ge=i.__chunk_7322,We=i.__chunk_2296,qe=i.__chunk_4101,He=i.__chunk_6776,ze=i.__chunk_8042,Ye=i.__chunk_3665,Ve=i.__chunk_6991,Ze=i.__chunk_8816,Je=i.__chunk_6631,Qe=i.__chunk_4828,et=i.__chunk_828,tt=i.__chunk_5927,nt=i.__chunk_6202,_t=i.__chunk_4363,rt=i.__chunk_8264,ot=i.__chunk_1583,at=i.__chunk_7908,st=i.__chunk_8949,ct=i.__chunk_796,ut=i.__chunk_1651,it=i.__chunk_5105,pt=i.__chunk_9642,ht=i.__chunk_8819,dt=i.__chunk_676,Z=ue(h,h,h),kt=Z.__NEXT_FONT_MANIFEST,lt=Z.__REACT_LOADABLE_MANIFEST,Pt=((u,k,C)=>(k._ENTRIES={},u.__BUILD_MANIFEST={polyfillFiles:["static/chunks/polyfills-42372ed130431b0a.js"],devFiles:[],ampDevFiles:[],lowPriorityFiles:[],rootMainFiles:["static/chunks/webpack-ab9b5bdd0084cc23.js","static/chunks/fd9d1056-b6bd4111191f2b98.js","static/chunks/30-831c6f736de22b6a.js","static/chunks/main-app-197e90683a538661.js"],pages:{"/_app":["static/chunks/webpack-ab9b5bdd0084cc23.js","static/chunks/framework-f66176bb897dc684.js","static/chunks/main-8267e90745dfb882.js","static/chunks/pages/_app-72b849fbd24ac258.js"],"/_error":["static/chunks/webpack-ab9b5bdd0084cc23.js","static/chunks/framework-f66176bb897dc684.js","static/chunks/main-8267e90745dfb882.js","static/chunks/pages/_error-7ba65e1336b92748.js"]},ampFirstPages:[]},u.__BUILD_MANIFEST.lowPriorityFiles=["/static/ghdMjizDpB_f99iwsV4y3/_buildManifest.js",,"/static/ghdMjizDpB_f99iwsV4y3/_ssgManifest.js"],u.__REACT_LOADABLE_MANIFEST=lt,u.__NEXT_FONT_MANIFEST=kt,u.__INTERCEPTION_ROUTE_REWRITE_MANIFEST="[]",(()=>{"use strict";var x={},E={};function r(t){var a=E[t];if(a!==void 0)return a.exports;var n=E[t]={exports:{}},l=!0;try{x[t].call(n.exports,n,n.exports,r),l=!1}finally{l&&delete E[t]}return n.exports}r.m=x,r.amdO={},(()=>{var t=[];r.O=(a,n,l,g)=>{if(n){g=g||0;for(var p=t.length;p>0&&t[p-1][2]>g;p--)t[p]=t[p-1];t[p]=[n,l,g];return}for(var c=1/0,p=0;p<t.length;p++){for(var[n,l,g]=t[p],b=!0,f=0;f<n.length;f++)c>=g&&Object.keys(r.O).every(T=>r.O[T](n[f]))?n.splice(f--,1):(b=!1,g<c&&(c=g));if(b){t.splice(p--,1);var w=l();w!==void 0&&(a=w)}}return a}})(),r.n=t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return r.d(a,{a}),a},(()=>{var t,a=Object.getPrototypeOf?n=>Object.getPrototypeOf(n):n=>n.__proto__;r.t=function(n,l){if(1&l&&(n=this(n)),8&l||typeof n=="object"&&n&&(4&l&&n.__esModule||16&l&&typeof n.then=="function"))return n;var g=Object.create(null);r.r(g);var p={};t=t||[null,a({}),a([]),a(a)];for(var c=2&l&&n;typeof c=="object"&&!~t.indexOf(c);c=a(c))Object.getOwnPropertyNames(c).forEach(b=>p[b]=()=>n[b]);return p.default=()=>n,r.d(g,p),g}})(),r.d=(t,a)=>{for(var n in a)r.o(a,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},r.e=()=>Promise.resolve(),r.g=function(){if(typeof k=="object")return k;try{return this||Function("return this")()}catch{if(typeof window=="object")return window}}(),r.o=(t,a)=>Object.prototype.hasOwnProperty.call(t,a),r.r=t=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t={993:0};r.O.j=l=>t[l]===0;var a=(l,g)=>{var p,c,[b,f,w]=g,j=0;if(b.some(L=>t[L]!==0)){for(p in f)r.o(f,p)&&(r.m[p]=f[p]);if(w)var M=w(r)}for(l&&l(g);j<b.length;j++)c=b[j],r.o(t,c)&&t[c]&&t[c][0](),t[c]=0;return r.O(M)},n=u.webpackChunk_N_E=u.webpackChunk_N_E||[];n.forEach(a.bind(null,0)),n.push=a.bind(null,n.push.bind(n))})(),r.nc=void 0})(),(u.webpackChunk_N_E=u.webpackChunk_N_E||[]).push([[467],{676:dt,8819:ht,9642:pt,5105:it,1651:ut,796:ct,8949:st,7908:at,1583:ot,8264:rt,4363:_t,6202:nt,5927:tt,828:et,4828:Qe,6631:Je,8816:Ze,6991:Ve,3665:Ye,8042:ze,6776:He,4101:qe,2296:We,5228:ge,5303:le,7322:Ge,5558:ke,5405:Be}]),(u.webpackChunk_N_E=u.webpackChunk_N_E||[]).push([[805],{4337:Xe,5996:Ke,7960:De,6914:Ue,9548:Fe,5028:$e,2039:Le,2988:Me,2561:Ce,5234:Te,932:Se,4591:je,7444:Re,662:we,7701:Ie,9573:Oe,3039:Ae,1863:Pe,5577:Ne,7037:ve,3818:ye,1730:be}]),(u.webpackChunk_N_E=u.webpackChunk_N_E||[]).push([[933],{4155:Ee,9985:xe,1175:me}]),(u.webpackChunk_N_E=u.webpackChunk_N_E||[]).push([[495],{2067:de,6195:he,6198:(x,E,r)=>{"use strict";r.r(E),r.d(E,{ComponentMod:()=>B,default:()=>G});var t={};r.r(t),r.d(t,{POST:()=>j,runtime:()=>w});var a={};r.r(a),r.d(a,{originalPathname:()=>K,patchFetch:()=>X,requestAsyncStorage:()=>T,routeModule:()=>S,serverHooks:()=>D,staticGenerationAsyncStorage:()=>U});var n=r(932),l=r(2561),g=r(4828),p=r(6631),c=r(9985),b=r(1175),f=r(5603);let w="edge";async function j(P){try{let{prompt:m,style:y="photographic",negativePrompt:e,size:s="1024*1024",n:o=1,model:_=f.qB.DEFAULT_IMAGE_MODEL,userId:v,isAdmin:N}=await P.json();if(!m)return c.xk.json({success:!1,error:"Prompt is required"},{status:400});if(!v)return c.xk.json({success:!1,error:"User must be logged in to generate images"},{status:401});if(!N){let R=process.env.WORKER_URL||"https://recipe-easy.annnb016.workers.dev",A=await fetch(`${R}/api/user-usage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:v,action:"spend",amount:o,description:`Generated ${o} image(s)`})});if(!A.ok){let O=await A.json();return O.message==="Insufficient credits."?c.xk.json({success:!1,error:"Insufficient credits for image generation"},{status:402}):(console.error("\u6263\u51CF\u79EF\u5206\u5931\u8D25:",O),c.xk.json({success:!1,error:"Failed to process credits"},{status:500}))}}let I=e||(_==="wanx"?f.Ip.NEGATIVE_PROMPTS.WANX:f.Ip.NEGATIVE_PROMPTS.FLUX);return _==="wanx"?await M(m,y,I,s,o):_==="flux"?await L(m,I):c.xk.json({success:!1,error:`Unsupported model: ${_}`},{status:400})}catch(m){return console.error("Image generation error:",m),console.error("Error details:",m.response?.data||m.message),c.xk.json({success:!1,error:m.response?.data?.message||m.message||"Failed to generate image"},{status:500})}}async function M(P,m,y,e,s){let o=Math.min(Math.max(1,s),f.Ip.WANX.MAX_IMAGES);if(!process.env.DASHSCOPE_API_KEY)return console.error("DASHSCOPE_API_KEY \u73AF\u5883\u53D8\u91CF\u672A\u8BBE\u7F6E"),c.xk.json({success:!1,error:"API key is not configured"},{status:500});let _={model:f.Ip.WANX.MODEL,input:{prompt:P,negative_prompt:y},parameters:{style:f.Ip.WANX.STYLES.includes(m)?m:"photographic",size:e,n:o,return_type:"url"}},v=(await b.Z.post(f.Ip.WANX.BASE_URL,_,{headers:{Authorization:`Bearer ${process.env.DASHSCOPE_API_KEY}`,"Content-Type":"application/json",Accept:"application/json","X-DashScope-Async":"enable"}})).data.output.task_id;if(!v)throw Error("Failed to get task_id from async submission");return c.xk.json({success:!0,taskId:v})}async function L(P,m){if(!process.env.REPLICATE_API_TOKEN)return console.error("REPLICATE_API_TOKEN \u73AF\u5883\u53D8\u91CF\u672A\u8BBE\u7F6E"),c.xk.json({success:!1,error:"Replicate API token is not configured"},{status:500});let y=(await b.Z.post(`${f.Ip.REPLICATE.BASE_URL}/predictions`,{version:"black-forest-labs/flux-schnell",input:{prompt:P,negative_prompt:m,aspect_ratio:"1:1",output_format:"png"}},{headers:{Authorization:`Token ${process.env.REPLICATE_API_TOKEN}`,"Content-Type":"application/json"}})).data.id;if(!y)throw Error("Failed to get task ID from Replicate submission");return c.xk.json({success:!0,taskId:y})}let S=new l.AppRouteRouteModule({definition:{kind:g.x.APP_ROUTE,page:"/api/generate-image/route",pathname:"/api/generate-image",filename:"route",bundlePath:"app/api/generate-image/route"},resolvedPagePath:"/Users/nasirann/Documents/GitHub/recipe-easy/app/api/generate-image/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:T,staticGenerationAsyncStorage:U,serverHooks:D}=S,K="/api/generate-image/route";function X(){return(0,p.XH)({serverHooks:D,staticGenerationAsyncStorage:U})}let B=a,G=n.a.wrap(S)},5603:pe},x=>{var E=t=>x(x.s=t);x.O(0,[467,805,933],()=>E(6198));var r=x.O();(k._ENTRIES=typeof k._ENTRIES>"u"?{}:k._ENTRIES)["middleware_app/api/generate-image/route"]=r}]),function(){let x={exports:{},loaded:!1};return function(r,t){var a=Object.create,n=Object.defineProperty,l=Object.getOwnPropertyDescriptor,g=Object.getOwnPropertyNames,p=Object.getPrototypeOf,c=Object.prototype.hasOwnProperty,b=e=>n(e,"__esModule",{value:!0}),f=(e,s)=>{b(e);for(var o in s)n(e,o,{get:s[o],enumerable:!0})},w=(e,s,o)=>{if(s&&typeof s=="object"||typeof s=="function")for(let _ of g(s))!c.call(e,_)&&_!=="default"&&n(e,_,{get:()=>s[_],enumerable:!(o=l(s,_))||o.enumerable});return e},j=e=>w(b(n(e!=null?a(p(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);f(t,{default:()=>G});var M=j((Y(),ne($))),L="@next/request-context",S=Symbol.for(L),T=Symbol.for("internal.storage");function U(){let e=k;if(!e[S]){let s=new M.AsyncLocalStorage,o={get:()=>s.getStore(),[T]:s};e[S]=o}return e[S]}var D=U();function K(e,s){return D[T].run(e,s)}function X(e){let s={};return e&&e.forEach((o,_)=>{s[_]=o,_.toLowerCase()==="set-cookie"&&(s[_]=B(o))}),s}function B(e){let s=[],o=0,_,v,N,I,R;function A(){for(;o<e.length&&/\s/.test(e.charAt(o));)o+=1;return o<e.length}function O(){return v=e.charAt(o),v!=="="&&v!==";"&&v!==","}for(;o<e.length;){for(_=o,R=!1;A();)if(v=e.charAt(o),v===","){for(N=o,o+=1,A(),I=o;o<e.length&&O();)o+=1;o<e.length&&e.charAt(o)==="="?(R=!0,o=I,s.push(e.substring(_,N)),_=o):o=N+1}else o+=1;(!R||o>=e.length)&&s.push(e.substring(_,e.length))}return s}function G(e){let s=e.staticRoutes.map(_=>({regexp:new RegExp(_.namedRegex),page:_.page})),o=e.dynamicRoutes?.map(_=>({regexp:new RegExp(_.namedRegex),page:_.page}))||[];return async function(_,v){let N=new URL(_.url).pathname,I={};if(e.nextConfig?.basePath&&N.startsWith(e.nextConfig.basePath)&&(N=N.replace(e.nextConfig.basePath,"")||"/"),e.nextConfig?.i18n)for(let A of e.nextConfig.i18n.locales){let O=new RegExp(`^/${A}($|/)`,"i");if(N.match(O)){N=N.replace(O,"/")||"/";break}}for(let A of s)if(A.regexp.exec(N)){I.name=A.page;break}if(!I.name){let A=m(N);for(let O of o||[]){if(A&&!m(O.page))continue;let H=O.regexp.exec(N);if(H){I={name:O.page,params:H.groups};break}}}let R=await K({waitUntil:v.waitUntil},()=>k._ENTRIES[`middleware_${e.name}`].default.call({},{request:{url:_.url,method:_.method,headers:X(_.headers),ip:P(_.headers,y.Ip),geo:{city:P(_.headers,y.City,!0),country:P(_.headers,y.Country,!0),latitude:P(_.headers,y.Latitude),longitude:P(_.headers,y.Longitude),region:P(_.headers,y.Region,!0)},nextConfig:e.nextConfig,page:I,body:_.body}}));return R.waitUntil&&v.waitUntil(R.waitUntil),R.response}}function P(e,s,o=!1){let _=e.get(s)||void 0;return o&&_?decodeURIComponent(_):_}function m(e){return e==="/api"||e.startsWith("/api/")}var y;(function(e){e.City="x-vercel-ip-city",e.Country="x-vercel-ip-country",e.Ip="x-real-ip",e.Latitude="x-vercel-ip-latitude",e.Longitude="x-vercel-ip-longitude",e.Region="x-vercel-ip-country-region"})(y||(y={}))}(x,x.exports),x.exports}.call({}).default({name:"app/api/generate-image/route",staticRoutes:[{page:"/_not-found",regex:"^/_not\\-found(?:/)?$",routeKeys:{},namedRegex:"^/_not\\-found(?:/)?$"},{page:"/auth",regex:"^/auth(?:/)?$",routeKeys:{},namedRegex:"^/auth(?:/)?$"},{page:"/auth/callback",regex:"^/auth/callback(?:/)?$",routeKeys:{},namedRegex:"^/auth/callback(?:/)?$"},{page:"/robots.txt",regex:"^/robots\\.txt(?:/)?$",routeKeys:{},namedRegex:"^/robots\\.txt(?:/)?$"},{page:"/sitemap.xml",regex:"^/sitemap\\.xml(?:/)?$",routeKeys:{},namedRegex:"^/sitemap\\.xml(?:/)?$"}],dynamicRoutes:[{page:"/api/generate-image/status/[taskId]",regex:"^/api/generate\\-image/status/([^/]+?)(?:/)?$",routeKeys:{nxtPtaskId:"nxtPtaskId"},namedRegex:"^/api/generate\\-image/status/(?<nxtPtaskId>[^/]+?)(?:/)?$"},{page:"/api/recipes/[id]",regex:"^/api/recipes/([^/]+?)(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/api/recipes/(?<nxtPid>[^/]+?)(?:/)?$"},{page:"/[locale]",regex:"^/([^/]+?)(?:/)?$",routeKeys:{nxtPlocale:"nxtPlocale"},namedRegex:"^/(?<nxtPlocale>[^/]+?)(?:/)?$"},{page:"/[locale]/privacy",regex:"^/([^/]+?)/privacy(?:/)?$",routeKeys:{nxtPlocale:"nxtPlocale"},namedRegex:"^/(?<nxtPlocale>[^/]+?)/privacy(?:/)?$"},{page:"/[locale]/terms",regex:"^/([^/]+?)/terms(?:/)?$",routeKeys:{nxtPlocale:"nxtPlocale"},namedRegex:"^/(?<nxtPlocale>[^/]+?)/terms(?:/)?$"}],nextConfig:{basePath:""}})))(h,h,h);export{Pt as default};
