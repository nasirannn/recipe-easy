var Y=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var ee=Object.getOwnPropertyNames;var te=Object.prototype.hasOwnProperty;var ne=(u,l)=>()=>(u&&(l=u(u=0)),l);var q=(u,l,C,E)=>{if(l&&typeof l=="object"||typeof l=="function")for(let b of ee(l))!te.call(u,b)&&b!==C&&Y(u,b,{get:()=>l[b],enumerable:!(E=Q(l,b))||E.enumerable});return u},H=(u,l,C)=>(q(u,l,"default"),C&&q(C,l,"default"));var _e=u=>q(Y({},"__esModule",{value:!0}),u);var F={};import*as mt from"async_hooks";var V=ne(()=>{H(F,mt)});import{__getNamedExports as re}from"../../../__next-on-pages-dist__/webpack/5603.js";import{__getNamedExports as oe}from"../../../__next-on-pages-dist__/webpack/26df63ef8f6dd468813d90c00f151653.js";import{__getNamedExports as ae}from"../../../__next-on-pages-dist__/webpack/1175.js";import{__getNamedExports as se}from"../../../__next-on-pages-dist__/webpack/1d2470119d4f846d0a077893f2422c32.js";import{__getNamedExports as ce}from"../../../__next-on-pages-dist__/webpack/73a23316e6943b71c3775abd2b4c802e.js";import{__getNamedExports as ue}from"../../../__next-on-pages-dist__/webpack/7f9c4cac928c3718390c1c777cb83bc3.js";import{__getNamedExports as ie}from"../../../__next-on-pages-dist__/manifest/537259e2ed205f5a7994cb4f05664668.js";var h=globalThis.__nextOnPagesRoutesIsolation.getProxyFor("/api/generate-image"),pe=re(h,h,h),he=pe.__chunk_5603,U=oe(h,h,h),de=U.__chunk_6195,le=U.__chunk_2067,ke=U.__chunk_5558,ge=U.__chunk_5303,fe=U.__chunk_5228,me=ae(h,h,h),xe=me.__chunk_1175,Z=se(h,h,h),Ee=Z.__chunk_9985,be=Z.__chunk_4155,d=ce(h,h,h),ye=d.__chunk_1730,ve=d.__chunk_3818,Ne=d.__chunk_7037,Pe=d.__chunk_5577,Ae=d.__chunk_1863,Oe=d.__chunk_3039,Ie=d.__chunk_9573,we=d.__chunk_7701,Re=d.__chunk_662,je=d.__chunk_7444,Se=d.__chunk_4591,Te=d.__chunk_932,Ce=d.__chunk_5234,Me=d.__chunk_2561,Le=d.__chunk_2988,$e=d.__chunk_2039,Fe=d.__chunk_5028,Ue=d.__chunk_9548,De=d.__chunk_6914,Ke=d.__chunk_7960,Xe=d.__chunk_5996,Be=d.__chunk_4337,i=ue(h,h,h),Ge=i.__chunk_5405,We=i.__chunk_7322,qe=i.__chunk_2296,He=i.__chunk_4101,ze=i.__chunk_6776,Ye=i.__chunk_8042,Ve=i.__chunk_3665,Ze=i.__chunk_6991,Je=i.__chunk_8816,Qe=i.__chunk_6631,et=i.__chunk_4828,tt=i.__chunk_828,nt=i.__chunk_5927,_t=i.__chunk_6202,rt=i.__chunk_4363,ot=i.__chunk_8264,at=i.__chunk_1583,st=i.__chunk_7908,ct=i.__chunk_8949,ut=i.__chunk_796,it=i.__chunk_1651,pt=i.__chunk_5105,ht=i.__chunk_9642,dt=i.__chunk_8819,lt=i.__chunk_676,J=ie(h,h,h),kt=J.__NEXT_FONT_MANIFEST,gt=J.__REACT_LOADABLE_MANIFEST,At=((u,l,C)=>(l._ENTRIES={},u.__BUILD_MANIFEST={polyfillFiles:["static/chunks/polyfills-42372ed130431b0a.js"],devFiles:[],ampDevFiles:[],lowPriorityFiles:[],rootMainFiles:["static/chunks/webpack-ab9b5bdd0084cc23.js","static/chunks/fd9d1056-b6bd4111191f2b98.js","static/chunks/30-831c6f736de22b6a.js","static/chunks/main-app-197e90683a538661.js"],pages:{"/_app":["static/chunks/webpack-ab9b5bdd0084cc23.js","static/chunks/framework-f66176bb897dc684.js","static/chunks/main-8267e90745dfb882.js","static/chunks/pages/_app-72b849fbd24ac258.js"],"/_error":["static/chunks/webpack-ab9b5bdd0084cc23.js","static/chunks/framework-f66176bb897dc684.js","static/chunks/main-8267e90745dfb882.js","static/chunks/pages/_error-7ba65e1336b92748.js"]},ampFirstPages:[]},u.__BUILD_MANIFEST.lowPriorityFiles=["/static/e8eCtMmq16iDPm1nTWD8t/_buildManifest.js",,"/static/e8eCtMmq16iDPm1nTWD8t/_ssgManifest.js"],u.__REACT_LOADABLE_MANIFEST=gt,u.__NEXT_FONT_MANIFEST=kt,u.__INTERCEPTION_ROUTE_REWRITE_MANIFEST="[]",(()=>{"use strict";var E={},b={};function _(t){var a=b[t];if(a!==void 0)return a.exports;var n=b[t]={exports:{}},k=!0;try{E[t].call(n.exports,n,n.exports,_),k=!1}finally{k&&delete b[t]}return n.exports}_.m=E,_.amdO={},(()=>{var t=[];_.O=(a,n,k,f)=>{if(n){f=f||0;for(var p=t.length;p>0&&t[p-1][2]>f;p--)t[p]=t[p-1];t[p]=[n,k,f];return}for(var c=1/0,p=0;p<t.length;p++){for(var[n,k,f]=t[p],y=!0,g=0;g<n.length;g++)c>=f&&Object.keys(_.O).every(T=>_.O[T](n[g]))?n.splice(g--,1):(y=!1,f<c&&(c=f));if(y){t.splice(p--,1);var w=k();w!==void 0&&(a=w)}}return a}})(),_.n=t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return _.d(a,{a}),a},(()=>{var t,a=Object.getPrototypeOf?n=>Object.getPrototypeOf(n):n=>n.__proto__;_.t=function(n,k){if(1&k&&(n=this(n)),8&k||typeof n=="object"&&n&&(4&k&&n.__esModule||16&k&&typeof n.then=="function"))return n;var f=Object.create(null);_.r(f);var p={};t=t||[null,a({}),a([]),a(a)];for(var c=2&k&&n;typeof c=="object"&&!~t.indexOf(c);c=a(c))Object.getOwnPropertyNames(c).forEach(y=>p[y]=()=>n[y]);return p.default=()=>n,_.d(f,p),f}})(),_.d=(t,a)=>{for(var n in a)_.o(a,n)&&!_.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},_.e=()=>Promise.resolve(),_.g=function(){if(typeof l=="object")return l;try{return this||Function("return this")()}catch{if(typeof window=="object")return window}}(),_.o=(t,a)=>Object.prototype.hasOwnProperty.call(t,a),_.r=t=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t={993:0};_.O.j=k=>t[k]===0;var a=(k,f)=>{var p,c,[y,g,w]=f,j=0;if(y.some(L=>t[L]!==0)){for(p in g)_.o(g,p)&&(_.m[p]=g[p]);if(w)var M=w(_)}for(k&&k(f);j<y.length;j++)c=y[j],_.o(t,c)&&t[c]&&t[c][0](),t[c]=0;return _.O(M)},n=u.webpackChunk_N_E=u.webpackChunk_N_E||[];n.forEach(a.bind(null,0)),n.push=a.bind(null,n.push.bind(n))})(),_.nc=void 0})(),(u.webpackChunk_N_E=u.webpackChunk_N_E||[]).push([[467],{676:lt,8819:dt,9642:ht,5105:pt,1651:it,796:ut,8949:ct,7908:st,1583:at,8264:ot,4363:rt,6202:_t,5927:nt,828:tt,4828:et,6631:Qe,8816:Je,6991:Ze,3665:Ve,8042:Ye,6776:ze,4101:He,2296:qe,5228:fe,5303:ge,7322:We,5558:ke,5405:Ge}]),(u.webpackChunk_N_E=u.webpackChunk_N_E||[]).push([[805],{4337:Be,5996:Xe,7960:Ke,6914:De,9548:Ue,5028:Fe,2039:$e,2988:Le,2561:Me,5234:Ce,932:Te,4591:Se,7444:je,662:Re,7701:we,9573:Ie,3039:Oe,1863:Ae,5577:Pe,7037:Ne,3818:ve,1730:ye}]),(u.webpackChunk_N_E=u.webpackChunk_N_E||[]).push([[933],{4155:be,9985:Ee,1175:xe}]),(u.webpackChunk_N_E=u.webpackChunk_N_E||[]).push([[495],{2067:le,6195:de,6198:(E,b,_)=>{"use strict";_.r(b),_.d(b,{ComponentMod:()=>G,default:()=>W});var t={};_.r(t),_.d(t,{POST:()=>j,runtime:()=>w});var a={};_.r(a),_.d(a,{originalPathname:()=>X,patchFetch:()=>B,requestAsyncStorage:()=>T,routeModule:()=>S,serverHooks:()=>K,staticGenerationAsyncStorage:()=>D});var n=_(932),k=_(2561),f=_(4828),p=_(6631),c=_(9985),y=_(1175),g=_(5603);let w="edge";async function j(A){try{let{prompt:m,style:v="photographic",negativePrompt:e,size:s="1024*1024",n:r=1,model:o=g.qB.DEFAULT_IMAGE_MODEL,userId:N,isAdmin:x,language:R="en"}=await A.json();if(!m)return c.xk.json({success:!1,error:"Prompt is required"},{status:400});if(!N)return c.xk.json({success:!1,error:"User must be logged in to generate images"},{status:401});if(!x){let I=process.env.WORKER_URL||"https://recipe-easy.annnb016.workers.dev",$=await fetch(`${I}/api/user-usage`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:N,action:"spend",amount:r,description:`Generated ${r} image(s)`})});if(!$.ok){let z=await $.json();return z.message==="Insufficient credits."?c.xk.json({success:!1,error:"Insufficient credits for image generation"},{status:402}):(console.error("\u6263\u51CF\u79EF\u5206\u5931\u8D25:",z),c.xk.json({success:!1,error:"Failed to process credits"},{status:500}))}}let O=e||(o==="wanx"?g.Ip.NEGATIVE_PROMPTS.WANX:g.Ip.NEGATIVE_PROMPTS.FLUX),P=o;return x||(P=(0,g.Re)(R).imageModel),P==="wanx"?await M(m,v,O,s,r):P==="flux"?await L(m,O):c.xk.json({success:!1,error:`Unsupported model: ${P}`},{status:400})}catch(m){return console.error("Image generation error:",m),console.error("Error details:",m.response?.data||m.message),c.xk.json({success:!1,error:m.response?.data?.message||m.message||"Failed to generate image"},{status:500})}}async function M(A,m,v,e,s){let r=Math.min(Math.max(1,s),g.Ip.WANX.MAX_IMAGES);if(!process.env.DASHSCOPE_API_KEY)return console.error("DASHSCOPE_API_KEY \u73AF\u5883\u53D8\u91CF\u672A\u8BBE\u7F6E"),c.xk.json({success:!1,error:"API key is not configured"},{status:500});let o={model:g.Ip.WANX.MODEL,input:{prompt:A,negative_prompt:v},parameters:{style:g.Ip.WANX.STYLES.includes(m)?m:"photographic",size:e,n:r,return_type:"url"}},N=(await y.Z.post(g.Ip.WANX.BASE_URL,o,{headers:{Authorization:`Bearer ${process.env.DASHSCOPE_API_KEY}`,"Content-Type":"application/json",Accept:"application/json","X-DashScope-Async":"enable"}})).data.output.task_id;if(!N)throw Error("Failed to get task_id from async submission");return c.xk.json({success:!0,taskId:N})}async function L(A,m){if(!process.env.REPLICATE_API_TOKEN)return console.error("REPLICATE_API_TOKEN \u73AF\u5883\u53D8\u91CF\u672A\u8BBE\u7F6E"),c.xk.json({success:!1,error:"Replicate API token is not configured"},{status:500});let v=(await y.Z.post(`${g.Ip.REPLICATE.BASE_URL}/predictions`,{version:"black-forest-labs/flux-schnell",input:{prompt:A,negative_prompt:m,aspect_ratio:"1:1",output_format:"png"}},{headers:{Authorization:`Token ${process.env.REPLICATE_API_TOKEN}`,"Content-Type":"application/json"}})).data.id;if(!v)throw Error("Failed to get task ID from Replicate submission");return c.xk.json({success:!0,taskId:v})}let S=new k.AppRouteRouteModule({definition:{kind:f.x.APP_ROUTE,page:"/api/generate-image/route",pathname:"/api/generate-image",filename:"route",bundlePath:"app/api/generate-image/route"},resolvedPagePath:"/Users/nasirann/Documents/GitHub/recipe-easy/app/api/generate-image/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:T,staticGenerationAsyncStorage:D,serverHooks:K}=S,X="/api/generate-image/route";function B(){return(0,p.XH)({serverHooks:K,staticGenerationAsyncStorage:D})}let G=a,W=n.a.wrap(S)},5603:he},E=>{var b=t=>E(E.s=t);E.O(0,[467,805,933],()=>b(6198));var _=E.O();(l._ENTRIES=typeof l._ENTRIES>"u"?{}:l._ENTRIES)["middleware_app/api/generate-image/route"]=_}]),function(){let E={exports:{},loaded:!1};return function(_,t){var a=Object.create,n=Object.defineProperty,k=Object.getOwnPropertyDescriptor,f=Object.getOwnPropertyNames,p=Object.getPrototypeOf,c=Object.prototype.hasOwnProperty,y=e=>n(e,"__esModule",{value:!0}),g=(e,s)=>{y(e);for(var r in s)n(e,r,{get:s[r],enumerable:!0})},w=(e,s,r)=>{if(s&&typeof s=="object"||typeof s=="function")for(let o of f(s))!c.call(e,o)&&o!=="default"&&n(e,o,{get:()=>s[o],enumerable:!(r=k(s,o))||r.enumerable});return e},j=e=>w(y(n(e!=null?a(p(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);g(t,{default:()=>W});var M=j((V(),_e(F))),L="@next/request-context",S=Symbol.for(L),T=Symbol.for("internal.storage");function D(){let e=l;if(!e[S]){let s=new M.AsyncLocalStorage,r={get:()=>s.getStore(),[T]:s};e[S]=r}return e[S]}var K=D();function X(e,s){return K[T].run(e,s)}function B(e){let s={};return e&&e.forEach((r,o)=>{s[o]=r,o.toLowerCase()==="set-cookie"&&(s[o]=G(r))}),s}function G(e){let s=[],r=0,o,N,x,R,O;function P(){for(;r<e.length&&/\s/.test(e.charAt(r));)r+=1;return r<e.length}function I(){return N=e.charAt(r),N!=="="&&N!==";"&&N!==","}for(;r<e.length;){for(o=r,O=!1;P();)if(N=e.charAt(r),N===","){for(x=r,r+=1,P(),R=r;r<e.length&&I();)r+=1;r<e.length&&e.charAt(r)==="="?(O=!0,r=R,s.push(e.substring(o,x)),o=r):r=x+1}else r+=1;(!O||r>=e.length)&&s.push(e.substring(o,e.length))}return s}function W(e){let s=e.staticRoutes.map(o=>({regexp:new RegExp(o.namedRegex),page:o.page})),r=e.dynamicRoutes?.map(o=>({regexp:new RegExp(o.namedRegex),page:o.page}))||[];return async function(o,N){let x=new URL(o.url).pathname,R={};if(e.nextConfig?.basePath&&x.startsWith(e.nextConfig.basePath)&&(x=x.replace(e.nextConfig.basePath,"")||"/"),e.nextConfig?.i18n)for(let P of e.nextConfig.i18n.locales){let I=new RegExp(`^/${P}($|/)`,"i");if(x.match(I)){x=x.replace(I,"/")||"/";break}}for(let P of s)if(P.regexp.exec(x)){R.name=P.page;break}if(!R.name){let P=m(x);for(let I of r||[]){if(P&&!m(I.page))continue;let $=I.regexp.exec(x);if($){R={name:I.page,params:$.groups};break}}}let O=await X({waitUntil:N.waitUntil},()=>l._ENTRIES[`middleware_${e.name}`].default.call({},{request:{url:o.url,method:o.method,headers:B(o.headers),ip:A(o.headers,v.Ip),geo:{city:A(o.headers,v.City,!0),country:A(o.headers,v.Country,!0),latitude:A(o.headers,v.Latitude),longitude:A(o.headers,v.Longitude),region:A(o.headers,v.Region,!0)},nextConfig:e.nextConfig,page:R,body:o.body}}));return O.waitUntil&&N.waitUntil(O.waitUntil),O.response}}function A(e,s,r=!1){let o=e.get(s)||void 0;return r&&o?decodeURIComponent(o):o}function m(e){return e==="/api"||e.startsWith("/api/")}var v;(function(e){e.City="x-vercel-ip-city",e.Country="x-vercel-ip-country",e.Ip="x-real-ip",e.Latitude="x-vercel-ip-latitude",e.Longitude="x-vercel-ip-longitude",e.Region="x-vercel-ip-country-region"})(v||(v={}))}(E,E.exports),E.exports}.call({}).default({name:"app/api/generate-image/route",staticRoutes:[{page:"/_not-found",regex:"^/_not\\-found(?:/)?$",routeKeys:{},namedRegex:"^/_not\\-found(?:/)?$"},{page:"/auth",regex:"^/auth(?:/)?$",routeKeys:{},namedRegex:"^/auth(?:/)?$"},{page:"/auth/callback",regex:"^/auth/callback(?:/)?$",routeKeys:{},namedRegex:"^/auth/callback(?:/)?$"},{page:"/robots.txt",regex:"^/robots\\.txt(?:/)?$",routeKeys:{},namedRegex:"^/robots\\.txt(?:/)?$"},{page:"/sitemap.xml",regex:"^/sitemap\\.xml(?:/)?$",routeKeys:{},namedRegex:"^/sitemap\\.xml(?:/)?$"}],dynamicRoutes:[{page:"/api/generate-image/status/[taskId]",regex:"^/api/generate\\-image/status/([^/]+?)(?:/)?$",routeKeys:{nxtPtaskId:"nxtPtaskId"},namedRegex:"^/api/generate\\-image/status/(?<nxtPtaskId>[^/]+?)(?:/)?$"},{page:"/api/recipes/[id]",regex:"^/api/recipes/([^/]+?)(?:/)?$",routeKeys:{nxtPid:"nxtPid"},namedRegex:"^/api/recipes/(?<nxtPid>[^/]+?)(?:/)?$"},{page:"/[locale]",regex:"^/([^/]+?)(?:/)?$",routeKeys:{nxtPlocale:"nxtPlocale"},namedRegex:"^/(?<nxtPlocale>[^/]+?)(?:/)?$"},{page:"/[locale]/privacy",regex:"^/([^/]+?)/privacy(?:/)?$",routeKeys:{nxtPlocale:"nxtPlocale"},namedRegex:"^/(?<nxtPlocale>[^/]+?)/privacy(?:/)?$"},{page:"/[locale]/terms",regex:"^/([^/]+?)/terms(?:/)?$",routeKeys:{nxtPlocale:"nxtPlocale"},namedRegex:"^/(?<nxtPlocale>[^/]+?)/terms(?:/)?$"}],nextConfig:{basePath:""}})))(h,h,h);export{At as default};
